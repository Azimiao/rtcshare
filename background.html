<!DOCTYPE html>
<html>
<head>

</script>
<!-- <script src="js/background.js"></script> -->

<script>
"use strict";

var context;

window.onload = init;

var defaultFileName = "bewdy.m4a"
function init() {
  try {
    context = new webkitAudioContext();
  }
  catch(e) {
    alert('Web Audio API is not supported in this browser');
  }
	initBuffers();
	document.body.onkeydown = function(event){
		var key = keyCodes[event.keyCode];
		var fileName = phrases.hasOwnProperty(key) ? phrases[key] : defaultFileName;
		playSound(fileName);
	};
}

var phraseDirectory = "audio";
var phrases = {
	"a": "are-you-for-real.m4a", // 65
	"b": "bewdy.m4a", // 66
	"o": "oh-you-piker.m4a", //79
	"r": "rack-off.m4a" //82
};

var keyCodes ={65: "a", 66: "b", 79: "o", 82: "r"};

function initBuffers(){
	for (var keyName in phrases){
		var fileName = phrases[keyName];
		addToBuffers(fileName, phraseDirectory + "/" + fileName);
	}
}
var buffers = {};
function addToBuffers(name, url) {
  var request = new XMLHttpRequest();
  request.open('GET', url, true);
  request.responseType = "arraybuffer";
  request.onload = function() {
    context.decodeAudioData(request.response, function(buffer) {
      buffers[name]= buffer;
//      console.log(name, buffers[name]);
    }, function(error){console.log(error)});
  }
  request.send();
}

function playSound(fileName) {
	if (Object.keys(buffers).length !== Object.keys(phrases).length){ // yuk!
		return;
	}
	var buffer = buffers[fileName];
  var source = context.createBufferSource();
  source.buffer = buffer;
  source.connect(context.destination);
  source.noteOn(0);
}

</script>
</head>
</html>
